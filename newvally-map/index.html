<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>Ø®Ø±ÙŠØ·Ø© Ù…Ø¬Ù…Ø¹ Ø§Ù„Ù…ØµØ§Ù„Ø­ Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ© Ø¨Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯</title>

  <!-- Ù…ÙƒØªØ¨Ø© Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Ù…ÙƒØªØ¨Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ GPS -->
  <script src="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />

  <style>
    body {
      margin: 0;
      font-family: "Cairo", sans-serif;
      background-color: #f4f4f4;
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      text-align: center;
      background: linear-gradient(90deg, #006400, #228B22);
      color: white;
      width: 100%;
      padding: 20px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      font-size: 1.6rem;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    #map {
      height: 85vh;
      width: 90%;
      margin-top: 20px;
      border: 2px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    footer {
      margin-top: 10px;
      padding: 10px;
      font-size: 0.9rem;
      color: #555;
    }

    .leaflet-control-layers {
      font-family: "Cairo", sans-serif;
      font-size: 0.9rem;
    }
  </style>
</head>

<body>
  <header>Ø®Ø±ÙŠØ·Ø© Ù…Ø¬Ù…Ø¹ Ø§Ù„Ù…ØµØ§Ù„Ø­ Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ© Ø¨Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯</header>
  <div id="map"></div>
  <footer>Ø¥Ø¹Ø¯Ø§Ø¯: Ø¬Ù‡Ø§Ø² Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ù…Ø±Ø§ÙÙ‚ - Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯</footer>

  <script>
    var map = L.map('map').setView([25.687, 30.841], 16);

    // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø®Ø±Ø§Ø¦Ø· (Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©)
    var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: 'Â© OpenStreetMap contributors'
    });
    var esriSat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      attribution: 'Â© Esri, Maxar, Earthstar Geographics'
    });
    var topo = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
      maxZoom: 17,
      attribution: 'Â© OpenTopoMap'
    });

    osm.addTo(map);

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª
    var layersInfo = {
      "Ø®Ø·ÙˆØ· Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ âš¡": "electric_lines.geojson",
      "Ù…Ø­ÙˆÙ„ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ âš¡": "electric_points.geojson",
      "Ø®Ø·ÙˆØ· Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ğŸŒ": "landline_lines.geojson",
      "ØµÙ†Ø§Ø¯ÙŠÙ‚ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ğŸŒ": "landline_points.geojson",
      "Ø®Ø·ÙˆØ· Ø§Ù„ØµØ±Ù Ø§Ù„ØµØ­ÙŠ ğŸ’§": "Sewer_line.geojson",
      "ØºØ±Ù ØªÙØªÙŠØ´ Ø§Ù„ØµØ±Ù Ø§Ù„ØµØ­ÙŠ ğŸ’§": "Sewer_points1.geojson",
      "ØºØ±Ù ØºØ³ÙŠÙ„ Ø§Ù„ØµØ±Ù Ø§Ù„ØµØ­ÙŠ ğŸ’§": "Sewer_points2.geojson",
      "Ù…Ø­Ø§Ø¨Ø³ Ø§Ù„ØµØ±Ù Ø§Ù„ØµØ­ÙŠ ğŸ’§": "Sewer_points3.geojson",
      "Ù…Ø­Ø·Ø© Ø§Ù„Ø±ÙØ¹ ğŸ’§": "Sewer_station.geojson",
      "Ø®Ø·ÙˆØ· Ø§Ù„Ù…ÙŠØ§Ù‡ ğŸš°": "water_lines.geojson",
      "Ù…Ø­Ø§Ø¨Ø³ Ø§Ù„Ù…ÙŠØ§Ù‡ ğŸš°": "water_points.geojson"
    };

    var overlayMaps = {};
    var colors = [
      "#e41a1c", "#377eb8", "#4daf4a", "#984ea3", "#ff7f00",
      "#a65628", "#f781bf", "#999999", "#66c2a5", "#fc8d62", "#8da0cb"
    ];
    var colorIndex = 0;

    for (const [name, file] of Object.entries(layersInfo)) {
      fetch("layers/" + file)
        .then(response => response.json())
        .then(data => {
          var layer = L.geoJSON(data, {
            style: {
              color: colors[colorIndex % colors.length],
              weight: 2,
              fillOpacity: 0.5
            },
            onEachFeature: function (feature, layer) {
              if (feature.properties) {
                let popupContent = "";
                for (const key in feature.properties) {
                  popupContent += `<strong>${key}:</strong> ${feature.properties[key]}<br>`;
                }
                layer.bindPopup(popupContent);
              }
            }
          }).addTo(map);
          overlayMaps[name] = layer;
          colorIndex++;
          L.control.layers(null, overlayMaps, { collapsed: false }).addTo(map);
        })
        .catch(err => console.warn("Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„:", file));
    }

    // Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ GPS
    L.control.locate({
      position: 'topleft',
      strings: { title: "ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ" },
      flyTo: true,
      showPopup: true,
      locateOptions: { enableHighAccuracy: true }
    }).addTo(map);
  </script>
</body>
</html>
