<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>خريطة مجمع المصالح الحكومية بمحافظة الوادي الجديد</title>

  <!-- مكتبة Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- مكتبة لتحديد الموقع GPS -->
  <script src="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />

  <style>
    body {
      margin: 0;
      font-family: "Cairo", sans-serif;
      background-color: #f4f4f4;
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      text-align: center;
      background: linear-gradient(90deg, #006400, #228B22);
      color: white;
      width: 100%;
      padding: 20px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      font-size: 1.6rem;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    #map {
      height: 85vh;
      width: 90%;
      margin-top: 20px;
      border: 2px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    footer {
      margin-top: 10px;
      padding: 10px;
      font-size: 0.9rem;
      color: #555;
    }

    .leaflet-control-layers {
      font-family: "Cairo", sans-serif;
      font-size: 0.9rem;
    }
  </style>
</head>

<body>
  <header>خريطة مجمع المصالح الحكومية بمحافظة الوادي الجديد</header>
  <div id="map"></div>
  <footer>إعداد: جهاز معلومات شبكات المرافق - محافظة الوادي الجديد</footer>

  <script>
    var map = L.map('map').setView([25.687, 30.841], 16);

    // أنواع الخرائط (الأساسية)
    var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap contributors'
    });
    var esriSat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      attribution: '© Esri, Maxar, Earthstar Geographics'
    });
    var topo = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
      maxZoom: 17,
      attribution: '© OpenTopoMap'
    });

    osm.addTo(map);

    // تحميل الطبقات
    var layersInfo = {
      "خطوط الكهرباء ⚡": "electric_lines.geojson",
      "محول كهرباء ⚡": "electric_points.geojson",
      "خطوط شبكات الإنترنت 🌐": "landline_lines.geojson",
      "صناديق توزيع الإنترنت 🌐": "landline_points.geojson",
      "خطوط الصرف الصحي 💧": "Sewer_line.geojson",
      "غرف تفتيش الصرف الصحي 💧": "Sewer_points1.geojson",
      "غرف غسيل الصرف الصحي 💧": "Sewer_points2.geojson",
      "محابس الصرف الصحي 💧": "Sewer_points3.geojson",
      "محطة الرفع 💧": "Sewer_station.geojson",
      "خطوط المياه 🚰": "water_lines.geojson",
      "محابس المياه 🚰": "water_points.geojson"
    };

    var overlayMaps = {};
    var colors = [
      "#e41a1c", "#377eb8", "#4daf4a", "#984ea3", "#ff7f00",
      "#a65628", "#f781bf", "#999999", "#66c2a5", "#fc8d62", "#8da0cb"
    ];
    var colorIndex = 0;

    for (const [name, file] of Object.entries(layersInfo)) {
      fetch("layers/" + file)
        .then(response => response.json())
        .then(data => {
          var layer = L.geoJSON(data, {
            style: {
              color: colors[colorIndex % colors.length],
              weight: 2,
              fillOpacity: 0.5
            },
            onEachFeature: function (feature, layer) {
              if (feature.properties) {
                let popupContent = "";
                for (const key in feature.properties) {
                  popupContent += `<strong>${key}:</strong> ${feature.properties[key]}<br>`;
                }
                layer.bindPopup(popupContent);
              }
            }
          }).addTo(map);
          overlayMaps[name] = layer;
          colorIndex++;
          L.control.layers(null, overlayMaps, { collapsed: false }).addTo(map);
        })
        .catch(err => console.warn("لم يتم تحميل:", file));
    }

    // زر تحديد الموقع GPS
    L.control.locate({
      position: 'topleft',
      strings: { title: "تحديد موقعي الحالي" },
      flyTo: true,
      showPopup: true,
      locateOptions: { enableHighAccuracy: true }
    }).addTo(map);
  </script>
</body>
</html>
